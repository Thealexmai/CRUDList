<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Settings</title>

	<!-- Defensive coding in case bootstrap server is down -->
	<link rel="stylesheet" href="css/bootstrap.css">
	<link rel="stylesheet" href="css/bootstrap-theme.css">
	<link rel="stylesheet" href="css/bootstrap.min.css">
	<script src="js/boostrap.min.js"></script>
	<script src="js/boostrap.js"></script>
	<link rel="stylesheet" href="css/boostrap-theme.min.css">

	<!-- Get from online -->
	<script
		src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
	<script
		src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
	<link rel="stylesheet"
		href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">

	<script type="text/javascript">
		$(document).ready(function() {
			$("#settings").hide();
			$("#wrongCookie").hide();
			$("#logoutbutton").hide();
			$("#editsuccess").hide();
			$("#editfail").hide();

			$.ajax({
				url: "/cgi-bin/validateCookie.py",
				type: "GET",
				dataType: "json",
				success: function(data) {
					console.log(data);
					if(data.hasCookie==true && data.match==true) {
						$("#settings").show();
						$("#logoutbutton").show();
					}
					else {
						$("#wrongCookie").show();

					}
				},
				error: function() {
					console.log("Error, something happened with cookie validation");
				},
			});

			//For password
			$("#newpassword").click(function() {
				$.ajax({
					url : "/cgi-bin/updatepass.py",
					data : {
						password : $("#password").val()
					},
					type : "POST",
					dataType : "text",
					success : function(data) {
						$("#editsuccess").fadeIn('slow');
						console.log(data);
					},
					// Code to run if the request fails
					error : function() {
						$("#editfail").fadeIn('slow');
						console.log("Aiya: " + data);
					},
				});
			});

			//For services
			$("#newservice").click(function() {
				$.ajax({
					url : "cgi-bin/updateservices.py",
					data : {
						service : $('input[name="servicebutton"]:checked').val()
					},
					type : "POST",
					dataType : "text",
					success : function(data) {
						$("#editsuccess").fadeIn('slow');
						console.log(data);
					},
					// Code to run if the request fails
					error : function() {
						$("#editfail").fadeIn('slow');
						console.log("Aiya: " + data);
					},
				});
			});

			//For description
			$("#newdescription").click(function() {
				$.ajax({
					url : "/cgi-bin/updatedescript.py",
					data : {
						description : $("#description").val()
					},
					type : "POST",
					dataType : "text",
					success : function(data) {
						$("#editsuccess").fadeIn('slow');
						console.log(data);
					},
					// Code to run if the request fails
					error : function() {
						$("#editfail").fadeIn('slow');
						console.log("Aiya: " + data);
					},
				});
			});

			$("#logoutbutton").click(function() {
				deleteCookie();
				window.location.replace("index.html");
			});
		}); //document ready
	</script>

<script type="text/javascript">
	function deleteCookie() {
			document.cookie = "email=" + null + ";";
	}
</script>
</head>

<body>
<nav class="navbar navbar-inverse">
	<div class="container-fluid">
		<div class="navbar-header">
			<a class="navbar-brand" href="index.html">CRUDList</a>
		</div>
		<div id="logout">
			<ul class="nav navbar-nav navbar-right">
				<li><button class="btn btn-warning btn-xs" id="logoutbutton"><span class="glyphicon glyphicon-off"> Logout</span></li>
			</ul>
		</div>
	</div>
</nav>

	<div class="container">
		<header>
			<h1>CRUDList</h1>
		</header>
		<!-- Only display wrong cookie material if validate cookie doesn't work -->
		<div id="wrongCookie">
			It seems like you haven't registered/logged in. Click here to return to the homepage <a href="index.html">Click me!</a>
		</div>

		<div id="settings">
			<h2>Update Settings</h2>
			<div class="col-xs-12" id="editsuccess">
				<h2>Your information has been edited!</h2>
			</div>
			<div class="col-xs-12" id="editfail">
				<h2>Invalid change. Please enter and try again.</h2>
			</div>
			<div class="form-group col-xs-12">
				<label for="newpassword">New Password:</label>
				<input type="password" class="form-control" placeholder="New Password" id="password" name="password" autofocus>
			</div>
			<div class="form-group col-xs-12 input-lg">
				<button class="btn btn-primary" id="newpassword">Change</button>
			</div>

			<!-- Radio buttons for services -->
			<div class="form-group col-xs-12">
				<label for="newservice">Services: </label>
				<label class="radio-inline"><input type="radio" value=0 name="servicebutton">Haircut</label>
				<label class="radio-inline"><input type="radio" value=1 name="servicebutton">Taxi</label>
				<label class="radio-inline"><input type="radio" value=2 name="servicebutton">Food</label>
				<label class="radio-inline"><input type="radio" value=3 name="servicebutton">Fix bicycle/car</label>
				<label class="radio-inline"><input type="radio" value=4 name="servicebutton">Make website</label>
			</div>
			<div class="form-group col-xs-12">
				<button class="btn btn-primary" id="newservice">Change</button>
			</div>

			<!-- The update things go in here -->
			<div class="form-group col-xs-12">
				<label for="newdescription">New Description:</label>
				<textarea id="description" class="form-control" name="description" rows="5" placeholder="Describe what you're looking for"></textarea>
			</div>

			<div class="form-group col-xs-12">
				<button class="btn btn-primary" id="newdescription">Change</button>
			</div>

			<div class="col-xs-12"><a class="btn btn-danger btn-xs" href="cgi-bin/delete.py" style="margin-top: 2%">Delete My Account</a></div>
		</div> <!-- #settings -->
	</div>
</body>
</html>